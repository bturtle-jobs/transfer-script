{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\owp\\\\src\\\\wrapper\\\\OwpSearchForm.js\";\nimport { Button, withStyles } from '@material-ui/core';\nimport ClearAllIcon from '@material-ui/icons/ClearAll';\nimport SearchIcon from '@material-ui/icons/Search';\nimport classNames from 'classnames';\nimport Formsy from 'formsy-react';\nimport { assignIn, debounce, get, isBoolean, isEmpty, isNil, mapValues, range, throttle } from 'lodash';\nimport FuseAnimate from 'owp/@fuse/components/FuseAnimate/FuseAnimate';\nimport { query, queryAll } from 'owp/api';\nimport { getAccessToken } from 'owp/auth';\nimport { deepKeysByObject } from 'owp/common';\nimport store from 'owp/store';\nimport { resetAutoComplate } from 'owp/store/actions/owp';\nimport PropTypes from 'prop-types';\nimport React, { useCallback, useEffect, useRef } from 'react';\nvar GET_ALL_DATA_VALUE = '@@@@@@';\nvar ACCESS_TOKEN = getAccessToken();\n\nvar styles = function styles(theme) {\n  return {\n    root: {},\n    button: {\n      margin: theme.spacing.unit,\n      whiteSpace: 'noWrap',\n      backgroundColor: '#354359',\n      color: 'white',\n      '&:hover': {\n        backgroundColor: '#495669',\n        color: 'white'\n      }\n    },\n    leftIcon: {\n      marginRight: theme.spacing.unit\n    },\n    rightIcon: {\n      marginLeft: theme.spacing.unit\n    },\n    iconSmall: {\n      fontSize: 16\n    }\n  };\n};\n\nfunction OwpSearchForm(_ref) {\n  var className = _ref.className,\n      classes = _ref.classes,\n      url = _ref.url,\n      urls = _ref.urls,\n      children = _ref.children,\n      isReady = _ref.isReady,\n      showSearchButton = _ref.showSearchButton,\n      showResetButton = _ref.showResetButton,\n      autoSubmit = _ref.autoSubmit,\n      onBeforeSubmit = _ref.onBeforeSubmit,\n      onSubmit = _ref.onSubmit,\n      onReset = _ref.onReset,\n      onMount = _ref.onMount,\n      onError = _ref.onError,\n      onSearchClick = _ref.onSearchClick,\n      afterMapping = _ref.afterMapping;\n\n  var _range$map = range(3).map(function () {\n    return useRef(null);\n  }),\n      _range$map2 = _slicedToArray(_range$map, 3),\n      formsyRef = _range$map2[0],\n      searchButtonRef = _range$map2[1],\n      resetButtonRef = _range$map2[2];\n\n  var _debounce = useCallback(debounce(function () {\n    var func = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n    return func();\n  }, 1000), []);\n\n  var _throttle = useCallback(throttle(function () {\n    var func = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n    return func();\n  }, 300), []);\n\n  var _dispatch = useCallback(throttle(function (action) {\n    store.dispatch(action);\n  }, 1000), []);\n\n  useEffect(function () {\n    var isUnmount = false;\n\n    if (autoSubmit) {\n      _debounce(function () {\n        return !isUnmount && handleSubmit();\n      });\n    }\n\n    onMount({\n      refs: _objectSpread(_objectSpread({\n        formsy: get(formsyRef, 'current')\n      }, showSearchButton && {\n        searchButton: get(searchButtonRef, 'current')\n      }), showResetButton && {\n        resetButton: get(resetButtonRef, 'current')\n      })\n    });\n    return function () {\n      isUnmount = true;\n    };\n  }, []);\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var values,\n          currentValuesOfFlattenerKeys,\n          model,\n          afterMappingValuesOfFlattenerKeys,\n          resultBeforeSubmitData,\n          params,\n          data,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              values = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n              _context.prev = 1;\n              currentValuesOfFlattenerKeys = formsyRef.current.getCurrentValues instanceof Function ? mapValues(formsyRef.current.getCurrentValues(), function (value) {\n                return isNil(value) ? '' : value === GET_ALL_DATA_VALUE ? '' : value;\n              }) : {};\n\n              if (isEmpty(currentValuesOfFlattenerKeys)) {\n                model = isEmpty(values) ? formsyRef.current.getModel() : values;\n                assignIn(currentValuesOfFlattenerKeys, Object.fromEntries(get(formsyRef.current, 'prevInputNames', deepKeysByObject(model)).map(function (key) {\n                  var value = get(model, key, '');\n                  return [key, value === GET_ALL_DATA_VALUE ? '' : value];\n                })));\n              }\n\n              if (afterMapping instanceof Function) {\n                afterMappingValuesOfFlattenerKeys = afterMapping(currentValuesOfFlattenerKeys);\n\n                if (!isEmpty(afterMappingValuesOfFlattenerKeys)) {\n                  currentValuesOfFlattenerKeys = afterMappingValuesOfFlattenerKeys;\n                }\n              }\n\n              if (!(onBeforeSubmit instanceof Function)) {\n                _context.next = 9;\n                break;\n              }\n\n              resultBeforeSubmitData = onBeforeSubmit(currentValuesOfFlattenerKeys);\n\n              if (!(!isNil(resultBeforeSubmitData) && isBoolean(resultBeforeSubmitData) && !resultBeforeSubmitData)) {\n                _context.next = 9;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 9:\n              if (!(isEmpty(url) && isEmpty(urls))) {\n                _context.next = 12;\n                break;\n              }\n\n              onSubmit([], currentValuesOfFlattenerKeys);\n              return _context.abrupt(\"return\");\n\n            case 12:\n              params = {\n                jsondata: JSON.stringify(_objectSpread(_objectSpread({}, currentValuesOfFlattenerKeys), {}, {\n                  VER: '2'\n                })),\n                TOKEN: ACCESS_TOKEN\n              };\n              _context.next = 15;\n              return !!url ? query({\n                url: url,\n                params: params\n              }) : queryAll(urls.map(function (url) {\n                return {\n                  url: url,\n                  params: params\n                };\n              }));\n\n            case 15:\n              _context.t0 = _context.sent;\n\n              if (_context.t0) {\n                _context.next = 18;\n                break;\n              }\n\n              _context.t0 = [];\n\n            case 18:\n              data = _context.t0;\n              onSubmit(data, currentValuesOfFlattenerKeys);\n              _context.next = 26;\n              break;\n\n            case 22:\n              _context.prev = 22;\n              _context.t1 = _context[\"catch\"](1);\n              console.error(_context.t1);\n              onError(_context.t1);\n\n            case 26:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 22]]);\n    }));\n\n    return function handleSubmit() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleReset = function handleReset() {\n    onReset();\n\n    _dispatch(resetAutoComplate(true));\n\n    _throttle(function () {\n      return _dispatch(resetAutoComplate(false));\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(Formsy, {\n    ref: formsyRef // onReset={handleReset}\n    ,\n    onSubmit: handleSubmit,\n    className: classNames('flex flex1 w-full items-center justify-between', className),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex items-start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 13\n    }\n  }, children), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex items-end\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }\n  }, showSearchButton && /*#__PURE__*/React.createElement(FuseAnimate, {\n    animation: \"transition.slideRightIn\",\n    delay: 300,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    className: classes.button,\n    type: \"submit\",\n    buttonRef: searchButtonRef,\n    disabled: !isReady,\n    onClick: onSearchClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(SearchIcon, {\n    className: classNames(classes.leftIcon, classes.iconSmall),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 29\n    }\n  }), \"\\uAC80\\xA0\\xA0\\xA0\\uC0C9\")), showResetButton && /*#__PURE__*/React.createElement(FuseAnimate, {\n    animation: \"transition.slideRightIn\",\n    delay: 300,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    className: classes.button // type=\"reset\"\n    ,\n    onClick: handleReset,\n    buttonRef: resetButtonRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(ClearAllIcon, {\n    className: classNames(classes.leftIcon, classes.iconSmall),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 29\n    }\n  }), \"\\uCD08\\uAE30\\uD654\"))));\n}\n\nOwpSearchForm.propTypes = {\n  className: PropTypes.string,\n  isReady: PropTypes.bool,\n  url: PropTypes.string,\n  urls: PropTypes.arrayOf(PropTypes.string),\n  showSearchButton: PropTypes.bool,\n  showResetButton: PropTypes.bool,\n  autoSubmit: PropTypes.bool,\n  onBeforeSubmit: PropTypes.func,\n  onSubmit: PropTypes.func,\n  onReset: PropTypes.func,\n  onMount: PropTypes.func,\n  onError: PropTypes.func,\n  onSearchClick: PropTypes.func,\n  afterMapping: PropTypes.func\n};\nOwpSearchForm.defaultProps = {\n  className: '',\n  url: '',\n  urls: [],\n  isReady: true,\n  showSearchButton: true,\n  showResetButton: true,\n  autoSubmit: false,\n  onSubmit: function onSubmit(data, model) {},\n  onReset: function onReset() {},\n  onMount: function onMount(_ref3) {\n    var ref = _ref3.ref;\n  },\n  onError: function onError() {},\n  onSearchClick: function onSearchClick(event) {}\n};\nexport default withStyles(styles, {\n  withTheme: true\n})(OwpSearchForm);","map":{"version":3,"sources":["C:/Projects/Trunks/OWP-GIT/owp-fe/node_modules/owp/src/wrapper/OwpSearchForm.js"],"names":["Button","withStyles","ClearAllIcon","SearchIcon","classNames","Formsy","assignIn","debounce","get","isBoolean","isEmpty","isNil","mapValues","range","throttle","FuseAnimate","query","queryAll","getAccessToken","deepKeysByObject","store","resetAutoComplate","PropTypes","React","useCallback","useEffect","useRef","GET_ALL_DATA_VALUE","ACCESS_TOKEN","styles","theme","root","button","margin","spacing","unit","whiteSpace","backgroundColor","color","leftIcon","marginRight","rightIcon","marginLeft","iconSmall","fontSize","OwpSearchForm","className","classes","url","urls","children","isReady","showSearchButton","showResetButton","autoSubmit","onBeforeSubmit","onSubmit","onReset","onMount","onError","onSearchClick","afterMapping","map","formsyRef","searchButtonRef","resetButtonRef","_debounce","func","_throttle","_dispatch","action","dispatch","isUnmount","handleSubmit","refs","formsy","searchButton","resetButton","values","currentValuesOfFlattenerKeys","current","getCurrentValues","Function","value","model","getModel","Object","fromEntries","key","afterMappingValuesOfFlattenerKeys","resultBeforeSubmitData","params","jsondata","JSON","stringify","VER","TOKEN","data","console","error","handleReset","propTypes","string","bool","arrayOf","defaultProps","ref","event","withTheme"],"mappings":"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","sourcesContent":["import { Button, withStyles } from '@material-ui/core';\r\nimport ClearAllIcon from '@material-ui/icons/ClearAll';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport classNames from 'classnames';\r\nimport Formsy from 'formsy-react';\r\nimport {\r\n    assignIn,\r\n    debounce,\r\n    get,\r\n    isBoolean,\r\n    isEmpty,\r\n    isNil,\r\n    mapValues,\r\n    range,\r\n    throttle,\r\n} from 'lodash';\r\nimport FuseAnimate from 'owp/@fuse/components/FuseAnimate/FuseAnimate';\r\nimport { query, queryAll } from 'owp/api';\r\nimport { getAccessToken } from 'owp/auth';\r\nimport { deepKeysByObject } from 'owp/common';\r\nimport store from 'owp/store';\r\nimport { resetAutoComplate } from 'owp/store/actions/owp';\r\nimport PropTypes from 'prop-types';\r\nimport React, { useCallback, useEffect, useRef } from 'react';\r\n\r\nconst GET_ALL_DATA_VALUE = '@@@@@@';\r\nconst ACCESS_TOKEN = getAccessToken();\r\n\r\nconst styles = (theme) => ({\r\n    root: {},\r\n    button: {\r\n        margin: theme.spacing.unit,\r\n        whiteSpace: 'noWrap',\r\n        backgroundColor: '#354359',\r\n        color: 'white',\r\n        '&:hover': {\r\n            backgroundColor: '#495669',\r\n            color: 'white',\r\n        },\r\n    },\r\n    leftIcon: {\r\n        marginRight: theme.spacing.unit,\r\n    },\r\n    rightIcon: {\r\n        marginLeft: theme.spacing.unit,\r\n    },\r\n    iconSmall: {\r\n        fontSize: 16,\r\n    },\r\n});\r\n\r\nfunction OwpSearchForm({\r\n    className,\r\n    classes,\r\n    url,\r\n    urls,\r\n    children,\r\n    isReady,\r\n    showSearchButton,\r\n    showResetButton,\r\n    autoSubmit,\r\n    onBeforeSubmit,\r\n    onSubmit,\r\n    onReset,\r\n    onMount,\r\n    onError,\r\n    onSearchClick,\r\n    afterMapping,\r\n}) {\r\n    const [formsyRef, searchButtonRef, resetButtonRef] = range(3).map(() => useRef(null));\r\n\r\n    const _debounce = useCallback(\r\n        debounce((func = () => {}) => func(), 1000),\r\n        []\r\n    );\r\n    const _throttle = useCallback(\r\n        throttle((func = () => {}) => func(), 300),\r\n        []\r\n    );\r\n    const _dispatch = useCallback(\r\n        throttle((action) => {\r\n            store.dispatch(action);\r\n        }, 1000),\r\n        []\r\n    );\r\n\r\n    useEffect(() => {\r\n        let isUnmount = false;\r\n\r\n        if (autoSubmit) {\r\n            _debounce(() => !isUnmount && handleSubmit());\r\n        }\r\n\r\n        onMount({\r\n            refs: {\r\n                formsy: get(formsyRef, 'current'),\r\n                ...(showSearchButton && { searchButton: get(searchButtonRef, 'current') }),\r\n                ...(showResetButton && { resetButton: get(resetButtonRef, 'current') }),\r\n            },\r\n        });\r\n\r\n        return () => {\r\n            isUnmount = true;\r\n        };\r\n    }, []);\r\n\r\n    const handleSubmit = async (values = {}) => {\r\n        try {\r\n            let currentValuesOfFlattenerKeys =\r\n                formsyRef.current.getCurrentValues instanceof Function\r\n                    ? mapValues(formsyRef.current.getCurrentValues(), (value) =>\r\n                          isNil(value) ? '' : value === GET_ALL_DATA_VALUE ? '' : value\r\n                      )\r\n                    : {};\r\n\r\n            if (isEmpty(currentValuesOfFlattenerKeys)) {\r\n                const model = isEmpty(values) ? formsyRef.current.getModel() : values;\r\n                assignIn(\r\n                    currentValuesOfFlattenerKeys,\r\n                    Object.fromEntries(\r\n                        get(formsyRef.current, 'prevInputNames', deepKeysByObject(model)).map(\r\n                            (key) => {\r\n                                const value = get(model, key, '');\r\n                                return [key, value === GET_ALL_DATA_VALUE ? '' : value];\r\n                            }\r\n                        )\r\n                    )\r\n                );\r\n            }\r\n\r\n            if (afterMapping instanceof Function) {\r\n                const afterMappingValuesOfFlattenerKeys = afterMapping(\r\n                    currentValuesOfFlattenerKeys\r\n                );\r\n\r\n                if (!isEmpty(afterMappingValuesOfFlattenerKeys)) {\r\n                    currentValuesOfFlattenerKeys = afterMappingValuesOfFlattenerKeys;\r\n                }\r\n            }\r\n\r\n            if (onBeforeSubmit instanceof Function) {\r\n                const resultBeforeSubmitData = onBeforeSubmit(currentValuesOfFlattenerKeys);\r\n                if (\r\n                    !isNil(resultBeforeSubmitData) &&\r\n                    isBoolean(resultBeforeSubmitData) &&\r\n                    !resultBeforeSubmitData\r\n                ) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (isEmpty(url) && isEmpty(urls)) {\r\n                onSubmit([], currentValuesOfFlattenerKeys);\r\n                return;\r\n            }\r\n\r\n            const params = {\r\n                jsondata: JSON.stringify({\r\n                    ...currentValuesOfFlattenerKeys,\r\n                    VER: '2',\r\n                }),\r\n                TOKEN: ACCESS_TOKEN,\r\n            };\r\n\r\n            const data =\r\n                (await (!!url\r\n                    ? query({\r\n                          url,\r\n                          params,\r\n                      })\r\n                    : queryAll(\r\n                          urls.map((url) => ({\r\n                              url,\r\n                              params,\r\n                          }))\r\n                      ))) || [];\r\n\r\n            onSubmit(data, currentValuesOfFlattenerKeys);\r\n        } catch (error) {\r\n            console.error(error);\r\n            onError(error);\r\n        }\r\n    };\r\n\r\n    const handleReset = () => {\r\n        onReset();\r\n        _dispatch(resetAutoComplate(true));\r\n        _throttle(() => _dispatch(resetAutoComplate(false)));\r\n    };\r\n\r\n    return (\r\n        <Formsy\r\n            ref={formsyRef}\r\n            // onReset={handleReset}\r\n            onSubmit={handleSubmit}\r\n            className={classNames('flex flex1 w-full items-center justify-between', className)}\r\n        >\r\n            <div className=\"flex items-start\">{children}</div>\r\n            <div className=\"flex items-end\">\r\n                {showSearchButton && (\r\n                    <FuseAnimate animation=\"transition.slideRightIn\" delay={300}>\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            className={classes.button}\r\n                            type=\"submit\"\r\n                            buttonRef={searchButtonRef}\r\n                            disabled={!isReady}\r\n                            onClick={onSearchClick}\r\n                        >\r\n                            <SearchIcon\r\n                                className={classNames(classes.leftIcon, classes.iconSmall)}\r\n                            />\r\n                            검&nbsp;&nbsp;&nbsp;색\r\n                        </Button>\r\n                    </FuseAnimate>\r\n                )}\r\n                {showResetButton && (\r\n                    <FuseAnimate animation=\"transition.slideRightIn\" delay={300}>\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            className={classes.button}\r\n                            // type=\"reset\"\r\n                            onClick={handleReset}\r\n                            buttonRef={resetButtonRef}\r\n                        >\r\n                            <ClearAllIcon\r\n                                className={classNames(classes.leftIcon, classes.iconSmall)}\r\n                            />\r\n                            초기화\r\n                        </Button>\r\n                    </FuseAnimate>\r\n                )}\r\n            </div>\r\n        </Formsy>\r\n    );\r\n}\r\n\r\nOwpSearchForm.propTypes = {\r\n    className: PropTypes.string,\r\n    isReady: PropTypes.bool,\r\n    url: PropTypes.string,\r\n    urls: PropTypes.arrayOf(PropTypes.string),\r\n    showSearchButton: PropTypes.bool,\r\n    showResetButton: PropTypes.bool,\r\n    autoSubmit: PropTypes.bool,\r\n    onBeforeSubmit: PropTypes.func,\r\n    onSubmit: PropTypes.func,\r\n    onReset: PropTypes.func,\r\n    onMount: PropTypes.func,\r\n    onError: PropTypes.func,\r\n    onSearchClick: PropTypes.func,\r\n    afterMapping: PropTypes.func,\r\n};\r\nOwpSearchForm.defaultProps = {\r\n    className: '',\r\n    url: '',\r\n    urls: [],\r\n    isReady: true,\r\n    showSearchButton: true,\r\n    showResetButton: true,\r\n    autoSubmit: false,\r\n    onSubmit: (data, model) => {},\r\n    onReset: () => {},\r\n    onMount: ({ ref }) => {},\r\n    onError: () => {},\r\n    onSearchClick: (event) => {},\r\n};\r\n\r\nexport default withStyles(styles, { withTheme: true })(OwpSearchForm);\r\n"]},"metadata":{},"sourceType":"module"}