{"ast":null,"code":"import _objectSpread from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\owp\\\\src\\\\wrapper\\\\OwpSearchHeader.js\";\nimport { Button, withStyles } from '@material-ui/core';\nimport ClearAllIcon from '@material-ui/icons/ClearAll';\nimport SearchIcon from '@material-ui/icons/Search';\nimport classNames from 'classnames';\nimport Formsy from 'formsy-react';\nimport { assignIn, debounce, get, isBoolean, isEmpty, isNil, mapValues, range, throttle } from 'lodash';\nimport FuseAnimate from 'owp/@fuse/components/FuseAnimate/FuseAnimate';\nimport { getAccessToken } from 'owp/auth';\nimport { deepKeysByObject, isJSON } from 'owp/common';\nimport { depr } from 'owp/debug';\nimport store from 'owp/store';\nimport { setNetworkStatus } from 'owp/store/actions';\nimport { resetAutoComplate } from 'owp/store/actions/owp';\nimport PropTypes from 'prop-types';\nimport React, { useCallback, useEffect, useRef } from 'react';\nimport OwpMessage from './OwpMessage';\nvar GET_ALL_DATA_VALUE = '@@@@@@';\nvar ACCESS_TOKEN = getAccessToken();\n\nvar styles = function styles(theme) {\n  return {\n    root: {},\n    button: {\n      margin: theme.spacing.unit,\n      whiteSpace: 'noWrap',\n      backgroundColor: '#354359',\n      color: 'white',\n      '&:hover': {\n        backgroundColor: '#495669',\n        color: 'white'\n      }\n    },\n    leftIcon: {\n      marginRight: theme.spacing.unit\n    },\n    rightIcon: {\n      marginLeft: theme.spacing.unit\n    },\n    iconSmall: {\n      fontSize: 16\n    }\n  };\n};\n\nfunction OwpSearchHeader(_ref) {\n  var className = _ref.className,\n      classes = _ref.classes,\n      url = _ref.url,\n      children = _ref.children,\n      gridId = _ref.gridId,\n      gridIndex = _ref.gridIndex,\n      subUrl = _ref.subUrl,\n      subKeyName = _ref.subKeyName,\n      subValName = _ref.subValName,\n      autoSubmit = _ref.autoSubmit,\n      showResetButton = _ref.showResetButton,\n      onBeforeSubmit = _ref.onBeforeSubmit,\n      onSubmit = _ref.onSubmit,\n      onReset = _ref.onReset,\n      onDataGet = _ref.onDataGet,\n      OnGetExportValue = _ref.OnGetExportValue,\n      onMount = _ref.onMount,\n      onError = _ref.onError,\n      callfunc = _ref.callfunc,\n      callfunc2 = _ref.callfunc2;\n\n  var _range$map = range(3).map(function () {\n    return useRef(null);\n  }),\n      _range$map2 = _slicedToArray(_range$map, 3),\n      formsyRef = _range$map2[0],\n      searchButtonRef = _range$map2[1],\n      resetButtonRef = _range$map2[2];\n\n  var _debounce = useCallback(function () {\n    var fn = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n    var delay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 300;\n    return debounce(fn, delay)();\n  }, []);\n\n  var _throttle = useCallback(throttle(function () {\n    var func = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n    return func();\n  }, 300), []);\n\n  var _dispatch = useCallback(throttle(function (action) {\n    store.dispatch(action);\n  }, 1000), []);\n\n  useEffect(function () {\n    var isUnmount = false;\n    onMount({\n      refs: _objectSpread({\n        formsy: get(formsyRef, 'current'),\n        searchButton: get(searchButtonRef, 'current')\n      }, showResetButton && {\n        resetButton: get(resetButtonRef, 'current')\n      })\n    });\n\n    _debounce(function () {\n      window.Grids.OnExpand = function (grid, row) {\n        if (!!subUrl && !!subKeyName && !!subValName) {\n          grid.Def.DETAIL.DetailTreeGrid = \"<bdo Data_Url=\\\"\".concat(process.env.REACT_APP_REST_API_URL, \"/\").concat(subUrl, \"?jsondata=%7B%22VER%22:%222%22,%22\").concat(subKeyName, \"%22:%22\").concat(row[subValName], \"%22%7D\\\" Page_Method=\\\"Get\\\"></bdo>\");\n        }\n      };\n\n      window.Grids.OnDataSend = function (grid, source, data, Func) {\n        _dispatch(setNetworkStatus('START'));\n      };\n\n      window.Grids.OnDataReceive = function (grid, source) {\n        _dispatch(setNetworkStatus('DONE'));\n      };\n\n      window.Grids.OnDataGet = function (grid, source, data, io) {\n        if (onDataGet instanceof Function && isJSON(data)) {\n          try {\n            return JSON.stringify(onDataGet(JSON.parse(data)));\n          } catch (error) {\n            console.error(error);\n          }\n        }\n      };\n\n      window.Grids.OnGetExportValue = function (grid, row, col, value) {\n        if (OnGetExportValue instanceof Function && row.Kind === 'Data') {\n          return OnGetExportValue(col, value);\n        }\n\n        return value;\n      };\n    });\n\n    if (autoSubmit) {\n      _debounce(function () {\n        return !isUnmount && handleSubmit();\n      }, 1000);\n    }\n\n    return function () {\n      isUnmount = true;\n      window.TGDelEvent();\n    };\n  }, []);\n\n  var handleSubmit = function handleSubmit() {\n    var values = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    try {\n      var currentValuesOfFlattenerKeys = formsyRef.current.getCurrentValues instanceof Function ? mapValues(formsyRef.current.getCurrentValues(), function (value) {\n        return isNil(value) ? '' : value === GET_ALL_DATA_VALUE ? '' : value;\n      }) : {};\n\n      if (isEmpty(currentValuesOfFlattenerKeys)) {\n        var model = isEmpty(values) ? formsyRef.current.getModel() : values;\n        assignIn(currentValuesOfFlattenerKeys, Object.fromEntries(get(formsyRef.current, 'prevInputNames', deepKeysByObject(model)).map(function (key) {\n          var value = get(model, key, '');\n          return [key, value === GET_ALL_DATA_VALUE ? '' : value];\n        })));\n      }\n\n      if (onBeforeSubmit instanceof Function) {\n        var resultBeforeSubmitData = onBeforeSubmit(currentValuesOfFlattenerKeys);\n\n        if (!isNil(resultBeforeSubmitData) && isBoolean(resultBeforeSubmitData) && !resultBeforeSubmitData) {\n          return;\n        }\n      }\n\n      if (callfunc instanceof Function) {\n        depr('[OwpSearchHeader]: `callfunc()` prop은 deprecate 되었습니다. `onBeforeSubmit(searchParams)` prop을 사용 바랍니다..');\n        callfunc();\n      }\n\n      if (!url) {\n        console.error('`url` prop 을 확인해주세요!');\n        return;\n      }\n\n      var gridInstance = !!gridId ? window.GetGrids().find(function (_ref2) {\n        var id = _ref2.id;\n        return id === gridId;\n      }) : get(window.GetGrids(), gridIndex);\n\n      if (!!gridInstance) {\n        gridInstance.Data.Data.Url = \"\".concat(process.env.REACT_APP_REST_API_URL, \"/\").concat(url, \"?jsondata=\").concat(encodeURI(JSON.stringify(_objectSpread(_objectSpread({}, currentValuesOfFlattenerKeys), {}, {\n          VER: '2'\n        }))), \"&TOKEN=\").concat(ACCESS_TOKEN);\n        gridInstance.ReloadBody();\n\n        if (onSubmit instanceof Function) {\n          onSubmit(currentValuesOfFlattenerKeys);\n        }\n\n        return;\n      }\n\n      OwpMessage({\n        message: 'Grid 생성 중 오류가 발생했습니다. 다시 시도해주세요.',\n        variant: 'error'\n      });\n    } catch (error) {\n      console.error(error);\n      onError(error);\n    }\n  };\n\n  var handleReset = throttle(function () {\n    if (onReset instanceof Function) {\n      onReset();\n    }\n\n    if (callfunc2 instanceof Function) {\n      depr('[OwpSearchHeader]: `callfunc2()` prop은 deprecate 되었습니다. `onReset()` prop을 사용 바랍니다..');\n      callfunc2();\n    }\n\n    _dispatch(resetAutoComplate(true));\n\n    _throttle(function () {\n      return _dispatch(resetAutoComplate(false));\n    });\n  }, 1000);\n  return /*#__PURE__*/React.createElement(Formsy, {\n    ref: formsyRef // onReset={handleReset}\n    ,\n    onSubmit: handleSubmit,\n    className: classNames('flex flex1 w-full items-center justify-between', className),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex items-start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }\n  }, children), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex items-end\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(FuseAnimate, {\n    animation: \"transition.slideRightIn\",\n    delay: 300,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    className: classes.button,\n    type: \"submit\",\n    buttonRef: searchButtonRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(SearchIcon, {\n    className: classNames(classes.leftIcon, classes.iconSmall),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 25\n    }\n  }), \"\\uAC80\\xA0\\xA0\\xA0\\uC0C9\")), showResetButton && /*#__PURE__*/React.createElement(FuseAnimate, {\n    animation: \"transition.slideRightIn\",\n    delay: 300,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    className: classes.button // type=\"reset\"\n    ,\n    onClick: handleReset,\n    buttonRef: resetButtonRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(ClearAllIcon, {\n    className: classNames(classes.leftIcon, classes.iconSmall),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 29\n    }\n  }), \"\\uCD08\\uAE30\\uD654\"))));\n}\n\nOwpSearchHeader.propTypes = {\n  className: PropTypes.string,\n  url: PropTypes.string,\n  gridId: PropTypes.string,\n  gridIndex: PropTypes.number,\n  subUrl: PropTypes.string,\n  subKeyName: PropTypes.string,\n  subValName: PropTypes.string,\n  autoSubmit: PropTypes.bool,\n  showResetButton: PropTypes.bool,\n  onBeforeSubmit: PropTypes.func,\n  onSubmit: PropTypes.func,\n  onReset: PropTypes.func,\n  onDataGet: PropTypes.func,\n  OnGetExportValue: PropTypes.func,\n  onMount: PropTypes.func,\n  onError: PropTypes.func\n};\nOwpSearchHeader.defaultProps = {\n  className: '',\n  gridId: '',\n  gridIndex: 0,\n  autoSubmit: false,\n  showResetButton: true,\n  onMount: function onMount() {},\n  onError: function onError() {}\n};\nexport default withStyles(styles, {\n  withTheme: true\n})(OwpSearchHeader);","map":{"version":3,"sources":["C:/Projects/Trunks/OWP-GIT/owp-fe/node_modules/owp/src/wrapper/OwpSearchHeader.js"],"names":["Button","withStyles","ClearAllIcon","SearchIcon","classNames","Formsy","assignIn","debounce","get","isBoolean","isEmpty","isNil","mapValues","range","throttle","FuseAnimate","getAccessToken","deepKeysByObject","isJSON","depr","store","setNetworkStatus","resetAutoComplate","PropTypes","React","useCallback","useEffect","useRef","OwpMessage","GET_ALL_DATA_VALUE","ACCESS_TOKEN","styles","theme","root","button","margin","spacing","unit","whiteSpace","backgroundColor","color","leftIcon","marginRight","rightIcon","marginLeft","iconSmall","fontSize","OwpSearchHeader","className","classes","url","children","gridId","gridIndex","subUrl","subKeyName","subValName","autoSubmit","showResetButton","onBeforeSubmit","onSubmit","onReset","onDataGet","OnGetExportValue","onMount","onError","callfunc","callfunc2","map","formsyRef","searchButtonRef","resetButtonRef","_debounce","fn","delay","_throttle","func","_dispatch","action","dispatch","isUnmount","refs","formsy","searchButton","resetButton","window","Grids","OnExpand","grid","row","Def","DETAIL","DetailTreeGrid","process","env","REACT_APP_REST_API_URL","OnDataSend","source","data","Func","OnDataReceive","OnDataGet","io","Function","JSON","stringify","parse","error","console","col","value","Kind","handleSubmit","TGDelEvent","values","currentValuesOfFlattenerKeys","current","getCurrentValues","model","getModel","Object","fromEntries","key","resultBeforeSubmitData","gridInstance","GetGrids","find","id","Data","Url","encodeURI","VER","ReloadBody","message","variant","handleReset","propTypes","string","number","bool","defaultProps","withTheme"],"mappings":";;;AAAA,SAASA,MAAT,EAAiBC,UAAjB,QAAmC,mBAAnC;AACA,OAAOC,YAAP,MAAyB,6BAAzB;AACA,OAAOC,UAAP,MAAuB,2BAAvB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,MAAP,MAAmB,cAAnB;AACA,SACIC,QADJ,EAEIC,QAFJ,EAGIC,GAHJ,EAIIC,SAJJ,EAKIC,OALJ,EAMIC,KANJ,EAOIC,SAPJ,EAQIC,KARJ,EASIC,QATJ,QAUO,QAVP;AAWA,OAAOC,WAAP,MAAwB,8CAAxB;AACA,SAASC,cAAT,QAA+B,UAA/B;AACA,SAASC,gBAAT,EAA2BC,MAA3B,QAAyC,YAAzC;AACA,SAASC,IAAT,QAAqB,WAArB;AACA,OAAOC,KAAP,MAAkB,WAAlB;AACA,SAASC,gBAAT,QAAiC,mBAAjC;AACA,SAASC,iBAAT,QAAkC,uBAAlC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,KAAP,IAAgBC,WAAhB,EAA6BC,SAA7B,EAAwCC,MAAxC,QAAsD,OAAtD;AACA,OAAOC,UAAP,MAAuB,cAAvB;AAEA,IAAMC,kBAAkB,GAAG,QAA3B;AACA,IAAMC,YAAY,GAAGd,cAAc,EAAnC;;AAEA,IAAMe,MAAM,GAAG,SAATA,MAAS,CAACC,KAAD;AAAA,SAAY;AACvBC,IAAAA,IAAI,EAAE,EADiB;AAEvBC,IAAAA,MAAM,EAAE;AACJC,MAAAA,MAAM,EAAEH,KAAK,CAACI,OAAN,CAAcC,IADlB;AAEJC,MAAAA,UAAU,EAAE,QAFR;AAGJC,MAAAA,eAAe,EAAE,SAHb;AAIJC,MAAAA,KAAK,EAAE,OAJH;AAKJ,iBAAW;AACPD,QAAAA,eAAe,EAAE,SADV;AAEPC,QAAAA,KAAK,EAAE;AAFA;AALP,KAFe;AAYvBC,IAAAA,QAAQ,EAAE;AACNC,MAAAA,WAAW,EAAEV,KAAK,CAACI,OAAN,CAAcC;AADrB,KAZa;AAevBM,IAAAA,SAAS,EAAE;AACPC,MAAAA,UAAU,EAAEZ,KAAK,CAACI,OAAN,CAAcC;AADnB,KAfY;AAkBvBQ,IAAAA,SAAS,EAAE;AACPC,MAAAA,QAAQ,EAAE;AADH;AAlBY,GAAZ;AAAA,CAAf;;AAuBA,SAASC,eAAT,OAqBG;AAAA,MApBCC,SAoBD,QApBCA,SAoBD;AAAA,MAnBCC,OAmBD,QAnBCA,OAmBD;AAAA,MAlBCC,GAkBD,QAlBCA,GAkBD;AAAA,MAjBCC,QAiBD,QAjBCA,QAiBD;AAAA,MAhBCC,MAgBD,QAhBCA,MAgBD;AAAA,MAfCC,SAeD,QAfCA,SAeD;AAAA,MAdCC,MAcD,QAdCA,MAcD;AAAA,MAbCC,UAaD,QAbCA,UAaD;AAAA,MAZCC,UAYD,QAZCA,UAYD;AAAA,MAXCC,UAWD,QAXCA,UAWD;AAAA,MAVCC,eAUD,QAVCA,eAUD;AAAA,MATCC,cASD,QATCA,cASD;AAAA,MARCC,QAQD,QARCA,QAQD;AAAA,MAPCC,OAOD,QAPCA,OAOD;AAAA,MANCC,SAMD,QANCA,SAMD;AAAA,MALCC,gBAKD,QALCA,gBAKD;AAAA,MAJCC,OAID,QAJCA,OAID;AAAA,MAHCC,OAGD,QAHCA,OAGD;AAAA,MAFCC,QAED,QAFCA,QAED;AAAA,MADCC,SACD,QADCA,SACD;;AAAA,mBACsDtD,KAAK,CAAC,CAAD,CAAL,CAASuD,GAAT,CAAa;AAAA,WAAMzC,MAAM,CAAC,IAAD,CAAZ;AAAA,GAAb,CADtD;AAAA;AAAA,MACQ0C,SADR;AAAA,MACmBC,eADnB;AAAA,MACoCC,cADpC;;AAGC,MAAMC,SAAS,GAAG/C,WAAW,CAAC;AAAA,QAACgD,EAAD,uEAAM,YAAM,CAAE,CAAd;AAAA,QAAgBC,KAAhB,uEAAwB,GAAxB;AAAA,WAAgCnE,QAAQ,CAACkE,EAAD,EAAKC,KAAL,CAAR,EAAhC;AAAA,GAAD,EAAwD,EAAxD,CAA7B;;AACA,MAAMC,SAAS,GAAGlD,WAAW,CACzBX,QAAQ,CAAC;AAAA,QAAC8D,IAAD,uEAAQ,YAAM,CAAE,CAAhB;AAAA,WAAqBA,IAAI,EAAzB;AAAA,GAAD,EAA8B,GAA9B,CADiB,EAEzB,EAFyB,CAA7B;;AAKA,MAAMC,SAAS,GAAGpD,WAAW,CACzBX,QAAQ,CAAC,UAACgE,MAAD,EAAY;AACjB1D,IAAAA,KAAK,CAAC2D,QAAN,CAAeD,MAAf;AACH,GAFO,EAEL,IAFK,CADiB,EAIzB,EAJyB,CAA7B;;AAOApD,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAIsD,SAAS,GAAG,KAAhB;AAEAhB,IAAAA,OAAO,CAAC;AACJiB,MAAAA,IAAI;AACAC,QAAAA,MAAM,EAAE1E,GAAG,CAAC6D,SAAD,EAAY,SAAZ,CADX;AAEAc,QAAAA,YAAY,EAAE3E,GAAG,CAAC8D,eAAD,EAAkB,SAAlB;AAFjB,SAGIZ,eAAe,IAAI;AAAE0B,QAAAA,WAAW,EAAE5E,GAAG,CAAC+D,cAAD,EAAiB,SAAjB;AAAlB,OAHvB;AADA,KAAD,CAAP;;AAQAC,IAAAA,SAAS,CAAC,YAAM;AACZa,MAAAA,MAAM,CAACC,KAAP,CAAaC,QAAb,GAAwB,UAAUC,IAAV,EAAgBC,GAAhB,EAAqB;AACzC,YAAI,CAAC,CAACnC,MAAF,IAAY,CAAC,CAACC,UAAd,IAA4B,CAAC,CAACC,UAAlC,EAA8C;AAC1CgC,UAAAA,IAAI,CAACE,GAAL,CAASC,MAAT,CAAgBC,cAAhB,6BAAmDC,OAAO,CAACC,GAAR,CAAYC,sBAA/D,cAAyFzC,MAAzF,+CAAoIC,UAApI,oBAAwJkC,GAAG,CAACjC,UAAD,CAA3J;AACH;AACJ,OAJD;;AAMA6B,MAAAA,MAAM,CAACC,KAAP,CAAaU,UAAb,GAA0B,UAAUR,IAAV,EAAgBS,MAAhB,EAAwBC,IAAxB,EAA8BC,IAA9B,EAAoC;AAC1DtB,QAAAA,SAAS,CAACxD,gBAAgB,CAAC,OAAD,CAAjB,CAAT;AACH,OAFD;;AAIAgE,MAAAA,MAAM,CAACC,KAAP,CAAac,aAAb,GAA6B,UAAUZ,IAAV,EAAgBS,MAAhB,EAAwB;AACjDpB,QAAAA,SAAS,CAACxD,gBAAgB,CAAC,MAAD,CAAjB,CAAT;AACH,OAFD;;AAIAgE,MAAAA,MAAM,CAACC,KAAP,CAAae,SAAb,GAAyB,UAACb,IAAD,EAAOS,MAAP,EAAeC,IAAf,EAAqBI,EAArB,EAA4B;AACjD,YAAIxC,SAAS,YAAYyC,QAArB,IAAiCrF,MAAM,CAACgF,IAAD,CAA3C,EAAmD;AAC/C,cAAI;AACA,mBAAOM,IAAI,CAACC,SAAL,CAAe3C,SAAS,CAAC0C,IAAI,CAACE,KAAL,CAAWR,IAAX,CAAD,CAAxB,CAAP;AACH,WAFD,CAEE,OAAOS,KAAP,EAAc;AACZC,YAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACH;AACJ;AACJ,OARD;;AAUAtB,MAAAA,MAAM,CAACC,KAAP,CAAavB,gBAAb,GAAgC,UAACyB,IAAD,EAAOC,GAAP,EAAYoB,GAAZ,EAAiBC,KAAjB,EAA2B;AACvD,YAAI/C,gBAAgB,YAAYwC,QAA5B,IAAwCd,GAAG,CAACsB,IAAJ,KAAa,MAAzD,EAAiE;AAC7D,iBAAOhD,gBAAgB,CAAC8C,GAAD,EAAMC,KAAN,CAAvB;AACH;;AAED,eAAOA,KAAP;AACH,OAND;AAOH,KAhCQ,CAAT;;AAkCA,QAAIrD,UAAJ,EAAgB;AACZe,MAAAA,SAAS,CAAC;AAAA,eAAM,CAACQ,SAAD,IAAcgC,YAAY,EAAhC;AAAA,OAAD,EAAqC,IAArC,CAAT;AACH;;AACD,WAAO,YAAM;AACThC,MAAAA,SAAS,GAAG,IAAZ;AACAK,MAAAA,MAAM,CAAC4B,UAAP;AACH,KAHD;AAIH,GApDQ,EAoDN,EApDM,CAAT;;AAsDA,MAAMD,YAAY,GAAG,SAAfA,YAAe,GAAiB;AAAA,QAAhBE,MAAgB,uEAAP,EAAO;;AAClC,QAAI;AACA,UAAMC,4BAA4B,GAC9B9C,SAAS,CAAC+C,OAAV,CAAkBC,gBAAlB,YAA8Cd,QAA9C,GACM3F,SAAS,CAACyD,SAAS,CAAC+C,OAAV,CAAkBC,gBAAlB,EAAD,EAAuC,UAACP,KAAD;AAAA,eAC5CnG,KAAK,CAACmG,KAAD,CAAL,GAAe,EAAf,GAAoBA,KAAK,KAAKjF,kBAAV,GAA+B,EAA/B,GAAoCiF,KADZ;AAAA,OAAvC,CADf,GAIM,EALV;;AAOA,UAAIpG,OAAO,CAACyG,4BAAD,CAAX,EAA2C;AACvC,YAAMG,KAAK,GAAG5G,OAAO,CAACwG,MAAD,CAAP,GAAkB7C,SAAS,CAAC+C,OAAV,CAAkBG,QAAlB,EAAlB,GAAiDL,MAA/D;AACA5G,QAAAA,QAAQ,CACJ6G,4BADI,EAEJK,MAAM,CAACC,WAAP,CACIjH,GAAG,CAAC6D,SAAS,CAAC+C,OAAX,EAAoB,gBAApB,EAAsCnG,gBAAgB,CAACqG,KAAD,CAAtD,CAAH,CAAkElD,GAAlE,CACI,UAACsD,GAAD,EAAS;AACL,cAAMZ,KAAK,GAAGtG,GAAG,CAAC8G,KAAD,EAAQI,GAAR,EAAa,EAAb,CAAjB;AACA,iBAAO,CAACA,GAAD,EAAMZ,KAAK,KAAKjF,kBAAV,GAA+B,EAA/B,GAAoCiF,KAA1C,CAAP;AACH,SAJL,CADJ,CAFI,CAAR;AAWH;;AAED,UAAInD,cAAc,YAAY4C,QAA9B,EAAwC;AACpC,YAAMoB,sBAAsB,GAAGhE,cAAc,CAACwD,4BAAD,CAA7C;;AAEA,YACI,CAACxG,KAAK,CAACgH,sBAAD,CAAN,IACAlH,SAAS,CAACkH,sBAAD,CADT,IAEA,CAACA,sBAHL,EAIE;AACE;AACH;AACJ;;AAED,UAAIzD,QAAQ,YAAYqC,QAAxB,EAAkC;AAC9BpF,QAAAA,IAAI,CACA,uGADA,CAAJ;AAIA+C,QAAAA,QAAQ;AACX;;AAED,UAAI,CAAChB,GAAL,EAAU;AACN0D,QAAAA,OAAO,CAACD,KAAR,CAAc,sBAAd;AACA;AACH;;AAED,UAAMiB,YAAY,GAAG,CAAC,CAACxE,MAAF,GACfiC,MAAM,CAACwC,QAAP,GAAkBC,IAAlB,CAAuB;AAAA,YAAGC,EAAH,SAAGA,EAAH;AAAA,eAAYA,EAAE,KAAK3E,MAAnB;AAAA,OAAvB,CADe,GAEf5C,GAAG,CAAC6E,MAAM,CAACwC,QAAP,EAAD,EAAoBxE,SAApB,CAFT;;AAIA,UAAI,CAAC,CAACuE,YAAN,EAAoB;AAChBA,QAAAA,YAAY,CAACI,IAAb,CAAkBA,IAAlB,CAAuBC,GAAvB,aACIpC,OAAO,CAACC,GAAR,CAAYC,sBADhB,cAEI7C,GAFJ,uBAEoBgF,SAAS,CACzB1B,IAAI,CAACC,SAAL,iCAAoBU,4BAApB;AAAkDgB,UAAAA,GAAG,EAAE;AAAvD,WADyB,CAF7B,oBAIWrG,YAJX;AAKA8F,QAAAA,YAAY,CAACQ,UAAb;;AAEA,YAAIxE,QAAQ,YAAY2C,QAAxB,EAAkC;AAC9B3C,UAAAA,QAAQ,CAACuD,4BAAD,CAAR;AACH;;AACD;AACH;;AAEDvF,MAAAA,UAAU,CAAC;AACPyG,QAAAA,OAAO,EAAE,kCADF;AAEPC,QAAAA,OAAO,EAAE;AAFF,OAAD,CAAV;AAIH,KAtED,CAsEE,OAAO3B,KAAP,EAAc;AACZC,MAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACA1C,MAAAA,OAAO,CAAC0C,KAAD,CAAP;AACH;AACJ,GA3ED;;AA6EA,MAAM4B,WAAW,GAAGzH,QAAQ,CAAC,YAAM;AAC/B,QAAI+C,OAAO,YAAY0C,QAAvB,EAAiC;AAC7B1C,MAAAA,OAAO;AACV;;AAED,QAAIM,SAAS,YAAYoC,QAAzB,EAAmC;AAC/BpF,MAAAA,IAAI,CACA,qFADA,CAAJ;AAIAgD,MAAAA,SAAS;AACZ;;AAEDU,IAAAA,SAAS,CAACvD,iBAAiB,CAAC,IAAD,CAAlB,CAAT;;AACAqD,IAAAA,SAAS,CAAC;AAAA,aAAME,SAAS,CAACvD,iBAAiB,CAAC,KAAD,CAAlB,CAAf;AAAA,KAAD,CAAT;AACH,GAf2B,EAezB,IAfyB,CAA5B;AAiBA,sBACI,oBAAC,MAAD;AACI,IAAA,GAAG,EAAE+C,SADT,CAEI;AAFJ;AAGI,IAAA,QAAQ,EAAE2C,YAHd;AAII,IAAA,SAAS,EAAE5G,UAAU,CAAC,gDAAD,EAAmD4C,SAAnD,CAJzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAMI;AAAK,IAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAmCG,QAAnC,CANJ,eAOI;AAAK,IAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,WAAD;AAAa,IAAA,SAAS,EAAC,yBAAvB;AAAiD,IAAA,KAAK,EAAE,GAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,MAAD;AACI,IAAA,OAAO,EAAC,UADZ;AAEI,IAAA,SAAS,EAAEF,OAAO,CAACf,MAFvB;AAGI,IAAA,IAAI,EAAC,QAHT;AAII,IAAA,SAAS,EAAEoC,eAJf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAMI,oBAAC,UAAD;AAAY,IAAA,SAAS,EAAElE,UAAU,CAAC6C,OAAO,CAACR,QAAT,EAAmBQ,OAAO,CAACJ,SAA3B,CAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IANJ,6BADJ,CADJ,EAYKa,eAAe,iBACZ,oBAAC,WAAD;AAAa,IAAA,SAAS,EAAC,yBAAvB;AAAiD,IAAA,KAAK,EAAE,GAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,MAAD;AACI,IAAA,OAAO,EAAC,UADZ;AAEI,IAAA,SAAS,EAAET,OAAO,CAACf,MAFvB,CAGI;AAHJ;AAII,IAAA,OAAO,EAAEqG,WAJb;AAKI,IAAA,SAAS,EAAEhE,cALf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAOI,oBAAC,YAAD;AACI,IAAA,SAAS,EAAEnE,UAAU,CAAC6C,OAAO,CAACR,QAAT,EAAmBQ,OAAO,CAACJ,SAA3B,CADzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAPJ,uBADJ,CAbR,CAPJ,CADJ;AAuCH;;AAEDE,eAAe,CAACyF,SAAhB,GAA4B;AACxBxF,EAAAA,SAAS,EAAEzB,SAAS,CAACkH,MADG;AAExBvF,EAAAA,GAAG,EAAE3B,SAAS,CAACkH,MAFS;AAGxBrF,EAAAA,MAAM,EAAE7B,SAAS,CAACkH,MAHM;AAIxBpF,EAAAA,SAAS,EAAE9B,SAAS,CAACmH,MAJG;AAKxBpF,EAAAA,MAAM,EAAE/B,SAAS,CAACkH,MALM;AAMxBlF,EAAAA,UAAU,EAAEhC,SAAS,CAACkH,MANE;AAOxBjF,EAAAA,UAAU,EAAEjC,SAAS,CAACkH,MAPE;AAQxBhF,EAAAA,UAAU,EAAElC,SAAS,CAACoH,IARE;AASxBjF,EAAAA,eAAe,EAAEnC,SAAS,CAACoH,IATH;AAUxBhF,EAAAA,cAAc,EAAEpC,SAAS,CAACqD,IAVF;AAWxBhB,EAAAA,QAAQ,EAAErC,SAAS,CAACqD,IAXI;AAYxBf,EAAAA,OAAO,EAAEtC,SAAS,CAACqD,IAZK;AAaxBd,EAAAA,SAAS,EAAEvC,SAAS,CAACqD,IAbG;AAcxBb,EAAAA,gBAAgB,EAAExC,SAAS,CAACqD,IAdJ;AAexBZ,EAAAA,OAAO,EAAEzC,SAAS,CAACqD,IAfK;AAgBxBX,EAAAA,OAAO,EAAE1C,SAAS,CAACqD;AAhBK,CAA5B;AAmBA7B,eAAe,CAAC6F,YAAhB,GAA+B;AAC3B5F,EAAAA,SAAS,EAAE,EADgB;AAE3BI,EAAAA,MAAM,EAAE,EAFmB;AAG3BC,EAAAA,SAAS,EAAE,CAHgB;AAI3BI,EAAAA,UAAU,EAAE,KAJe;AAK3BC,EAAAA,eAAe,EAAE,IALU;AAM3BM,EAAAA,OAAO,EAAE,mBAAM,CAAE,CANU;AAO3BC,EAAAA,OAAO,EAAE,mBAAM,CAAE;AAPU,CAA/B;AAUA,eAAehE,UAAU,CAAC8B,MAAD,EAAS;AAAE8G,EAAAA,SAAS,EAAE;AAAb,CAAT,CAAV,CAAwC9F,eAAxC,CAAf","sourcesContent":["import { Button, withStyles } from '@material-ui/core';\r\nimport ClearAllIcon from '@material-ui/icons/ClearAll';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport classNames from 'classnames';\r\nimport Formsy from 'formsy-react';\r\nimport {\r\n    assignIn,\r\n    debounce,\r\n    get,\r\n    isBoolean,\r\n    isEmpty,\r\n    isNil,\r\n    mapValues,\r\n    range,\r\n    throttle,\r\n} from 'lodash';\r\nimport FuseAnimate from 'owp/@fuse/components/FuseAnimate/FuseAnimate';\r\nimport { getAccessToken } from 'owp/auth';\r\nimport { deepKeysByObject, isJSON } from 'owp/common';\r\nimport { depr } from 'owp/debug';\r\nimport store from 'owp/store';\r\nimport { setNetworkStatus } from 'owp/store/actions';\r\nimport { resetAutoComplate } from 'owp/store/actions/owp';\r\nimport PropTypes from 'prop-types';\r\nimport React, { useCallback, useEffect, useRef } from 'react';\r\nimport OwpMessage from './OwpMessage';\r\n\r\nconst GET_ALL_DATA_VALUE = '@@@@@@';\r\nconst ACCESS_TOKEN = getAccessToken();\r\n\r\nconst styles = (theme) => ({\r\n    root: {},\r\n    button: {\r\n        margin: theme.spacing.unit,\r\n        whiteSpace: 'noWrap',\r\n        backgroundColor: '#354359',\r\n        color: 'white',\r\n        '&:hover': {\r\n            backgroundColor: '#495669',\r\n            color: 'white',\r\n        },\r\n    },\r\n    leftIcon: {\r\n        marginRight: theme.spacing.unit,\r\n    },\r\n    rightIcon: {\r\n        marginLeft: theme.spacing.unit,\r\n    },\r\n    iconSmall: {\r\n        fontSize: 16,\r\n    },\r\n});\r\n\r\nfunction OwpSearchHeader({\r\n    className,\r\n    classes,\r\n    url,\r\n    children,\r\n    gridId,\r\n    gridIndex,\r\n    subUrl,\r\n    subKeyName,\r\n    subValName,\r\n    autoSubmit,\r\n    showResetButton,\r\n    onBeforeSubmit,\r\n    onSubmit,\r\n    onReset,\r\n    onDataGet,\r\n    OnGetExportValue,\r\n    onMount,\r\n    onError,\r\n    callfunc,\r\n    callfunc2,\r\n}) {\r\n    const [formsyRef, searchButtonRef, resetButtonRef] = range(3).map(() => useRef(null));\r\n\r\n    const _debounce = useCallback((fn = () => {}, delay = 300) => debounce(fn, delay)(), []);\r\n    const _throttle = useCallback(\r\n        throttle((func = () => {}) => func(), 300),\r\n        []\r\n    );\r\n\r\n    const _dispatch = useCallback(\r\n        throttle((action) => {\r\n            store.dispatch(action);\r\n        }, 1000),\r\n        []\r\n    );\r\n\r\n    useEffect(() => {\r\n        let isUnmount = false;\r\n\r\n        onMount({\r\n            refs: {\r\n                formsy: get(formsyRef, 'current'),\r\n                searchButton: get(searchButtonRef, 'current'),\r\n                ...(showResetButton && { resetButton: get(resetButtonRef, 'current') }),\r\n            },\r\n        });\r\n\r\n        _debounce(() => {\r\n            window.Grids.OnExpand = function (grid, row) {\r\n                if (!!subUrl && !!subKeyName && !!subValName) {\r\n                    grid.Def.DETAIL.DetailTreeGrid = `<bdo Data_Url=\"${process.env.REACT_APP_REST_API_URL}/${subUrl}?jsondata=%7B%22VER%22:%222%22,%22${subKeyName}%22:%22${row[subValName]}%22%7D\" Page_Method=\"Get\"></bdo>`;\r\n                }\r\n            };\r\n\r\n            window.Grids.OnDataSend = function (grid, source, data, Func) {\r\n                _dispatch(setNetworkStatus('START'));\r\n            };\r\n\r\n            window.Grids.OnDataReceive = function (grid, source) {\r\n                _dispatch(setNetworkStatus('DONE'));\r\n            };\r\n\r\n            window.Grids.OnDataGet = (grid, source, data, io) => {\r\n                if (onDataGet instanceof Function && isJSON(data)) {\r\n                    try {\r\n                        return JSON.stringify(onDataGet(JSON.parse(data)));\r\n                    } catch (error) {\r\n                        console.error(error);\r\n                    }\r\n                }\r\n            };\r\n\r\n            window.Grids.OnGetExportValue = (grid, row, col, value) => {\r\n                if (OnGetExportValue instanceof Function && row.Kind === 'Data') {\r\n                    return OnGetExportValue(col, value);\r\n                }\r\n\r\n                return value;\r\n            };\r\n        });\r\n\r\n        if (autoSubmit) {\r\n            _debounce(() => !isUnmount && handleSubmit(), 1000);\r\n        }\r\n        return () => {\r\n            isUnmount = true;\r\n            window.TGDelEvent();\r\n        };\r\n    }, []);\r\n\r\n    const handleSubmit = (values = {}) => {\r\n        try {\r\n            const currentValuesOfFlattenerKeys =\r\n                formsyRef.current.getCurrentValues instanceof Function\r\n                    ? mapValues(formsyRef.current.getCurrentValues(), (value) =>\r\n                          isNil(value) ? '' : value === GET_ALL_DATA_VALUE ? '' : value\r\n                      )\r\n                    : {};\r\n\r\n            if (isEmpty(currentValuesOfFlattenerKeys)) {\r\n                const model = isEmpty(values) ? formsyRef.current.getModel() : values;\r\n                assignIn(\r\n                    currentValuesOfFlattenerKeys,\r\n                    Object.fromEntries(\r\n                        get(formsyRef.current, 'prevInputNames', deepKeysByObject(model)).map(\r\n                            (key) => {\r\n                                const value = get(model, key, '');\r\n                                return [key, value === GET_ALL_DATA_VALUE ? '' : value];\r\n                            }\r\n                        )\r\n                    )\r\n                );\r\n            }\r\n\r\n            if (onBeforeSubmit instanceof Function) {\r\n                const resultBeforeSubmitData = onBeforeSubmit(currentValuesOfFlattenerKeys);\r\n\r\n                if (\r\n                    !isNil(resultBeforeSubmitData) &&\r\n                    isBoolean(resultBeforeSubmitData) &&\r\n                    !resultBeforeSubmitData\r\n                ) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (callfunc instanceof Function) {\r\n                depr(\r\n                    '[OwpSearchHeader]: `callfunc()` prop은 deprecate 되었습니다. `onBeforeSubmit(searchParams)` prop을 사용 바랍니다..'\r\n                );\r\n\r\n                callfunc();\r\n            }\r\n\r\n            if (!url) {\r\n                console.error('`url` prop 을 확인해주세요!');\r\n                return;\r\n            }\r\n\r\n            const gridInstance = !!gridId\r\n                ? window.GetGrids().find(({ id }) => id === gridId)\r\n                : get(window.GetGrids(), gridIndex);\r\n\r\n            if (!!gridInstance) {\r\n                gridInstance.Data.Data.Url = `${\r\n                    process.env.REACT_APP_REST_API_URL\r\n                }/${url}?jsondata=${encodeURI(\r\n                    JSON.stringify({ ...currentValuesOfFlattenerKeys, VER: '2' })\r\n                )}&TOKEN=${ACCESS_TOKEN}`;\r\n                gridInstance.ReloadBody();\r\n\r\n                if (onSubmit instanceof Function) {\r\n                    onSubmit(currentValuesOfFlattenerKeys);\r\n                }\r\n                return;\r\n            }\r\n\r\n            OwpMessage({\r\n                message: 'Grid 생성 중 오류가 발생했습니다. 다시 시도해주세요.',\r\n                variant: 'error',\r\n            });\r\n        } catch (error) {\r\n            console.error(error);\r\n            onError(error);\r\n        }\r\n    };\r\n\r\n    const handleReset = throttle(() => {\r\n        if (onReset instanceof Function) {\r\n            onReset();\r\n        }\r\n\r\n        if (callfunc2 instanceof Function) {\r\n            depr(\r\n                '[OwpSearchHeader]: `callfunc2()` prop은 deprecate 되었습니다. `onReset()` prop을 사용 바랍니다..'\r\n            );\r\n\r\n            callfunc2();\r\n        }\r\n\r\n        _dispatch(resetAutoComplate(true));\r\n        _throttle(() => _dispatch(resetAutoComplate(false)));\r\n    }, 1000);\r\n\r\n    return (\r\n        <Formsy\r\n            ref={formsyRef}\r\n            // onReset={handleReset}\r\n            onSubmit={handleSubmit}\r\n            className={classNames('flex flex1 w-full items-center justify-between', className)}\r\n        >\r\n            <div className=\"flex items-start\">{children}</div>\r\n            <div className=\"flex items-end\">\r\n                <FuseAnimate animation=\"transition.slideRightIn\" delay={300}>\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        className={classes.button}\r\n                        type=\"submit\"\r\n                        buttonRef={searchButtonRef}\r\n                    >\r\n                        <SearchIcon className={classNames(classes.leftIcon, classes.iconSmall)} />\r\n                        검&nbsp;&nbsp;&nbsp;색\r\n                    </Button>\r\n                </FuseAnimate>\r\n                {showResetButton && (\r\n                    <FuseAnimate animation=\"transition.slideRightIn\" delay={300}>\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            className={classes.button}\r\n                            // type=\"reset\"\r\n                            onClick={handleReset}\r\n                            buttonRef={resetButtonRef}\r\n                        >\r\n                            <ClearAllIcon\r\n                                className={classNames(classes.leftIcon, classes.iconSmall)}\r\n                            />\r\n                            초기화\r\n                        </Button>\r\n                    </FuseAnimate>\r\n                )}\r\n            </div>\r\n        </Formsy>\r\n    );\r\n}\r\n\r\nOwpSearchHeader.propTypes = {\r\n    className: PropTypes.string,\r\n    url: PropTypes.string,\r\n    gridId: PropTypes.string,\r\n    gridIndex: PropTypes.number,\r\n    subUrl: PropTypes.string,\r\n    subKeyName: PropTypes.string,\r\n    subValName: PropTypes.string,\r\n    autoSubmit: PropTypes.bool,\r\n    showResetButton: PropTypes.bool,\r\n    onBeforeSubmit: PropTypes.func,\r\n    onSubmit: PropTypes.func,\r\n    onReset: PropTypes.func,\r\n    onDataGet: PropTypes.func,\r\n    OnGetExportValue: PropTypes.func,\r\n    onMount: PropTypes.func,\r\n    onError: PropTypes.func,\r\n};\r\n\r\nOwpSearchHeader.defaultProps = {\r\n    className: '',\r\n    gridId: '',\r\n    gridIndex: 0,\r\n    autoSubmit: false,\r\n    showResetButton: true,\r\n    onMount: () => {},\r\n    onError: () => {},\r\n};\r\n\r\nexport default withStyles(styles, { withTheme: true })(OwpSearchHeader);\r\n"]},"metadata":{},"sourceType":"module"}