{"ast":null,"code":"import _classCallCheck from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Projects\\\\Trunks\\\\OWP-GIT\\\\owp-fe\\\\node_modules\\\\owp\\\\src\\\\@fuse\\\\components\\\\FuseAuthorization\\\\FuseAuthorization.js\";\nimport _ from 'lodash';\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { matchRoutes } from 'react-router-config';\nimport { withRouter } from 'react-router-dom';\nimport { bindActionCreators } from 'redux';\nvar redirect = false;\n\nvar FuseAuthorization = /*#__PURE__*/function (_Component) {\n  _inherits(FuseAuthorization, _Component);\n\n  var _super = _createSuper(FuseAuthorization);\n\n  function FuseAuthorization(props) {\n    var _this;\n\n    _classCallCheck(this, FuseAuthorization);\n\n    _this = _super.call(this, props);\n\n    _this.checkAuth();\n\n    return _this;\n  }\n\n  _createClass(FuseAuthorization, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      /**\r\n       * If route is changed\r\n       * Update auths\r\n       */\n      if (!_.isEqual(this.props.location.pathname, prevProps.location.pathname)) {\n        this.checkAuth();\n      }\n    }\n  }, {\n    key: \"checkAuth\",\n    value: function checkAuth() {\n      var matched = matchRoutes(this.props.routes, this.props.location.pathname)[0];\n\n      if (process.env.REACT_APP_LOGIN_CHECK === 'false') {\n        redirect = false;\n        return;\n      }\n\n      if (process.env.REACT_APP_LOGIN_CHECK === 'true') {\n        if (matched && (!matched.route.auth || !matched.route.auth.length)) {\n          redirect = true;\n\n          if (this.props.user.role === 'guest') {\n            this.props.history.push({\n              pathname: '/login',\n              state: {\n                redirectUrl: this.props.location.pathname\n              }\n            });\n          }\n\n          return;\n        }\n\n        if (matched && matched.route.auth && matched.route.auth.length > 0) {\n          if (!matched.route.auth.includes(this.props.user.role)) {\n            redirect = true;\n\n            if (this.props.user.role === 'guest') {\n              this.props.history.push({\n                pathname: '/login',\n                state: {\n                  redirectUrl: this.props.location.pathname\n                }\n              });\n            } else {\n              this.props.history.push({\n                pathname: '/'\n              });\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (redirect) {\n        redirect = false;\n        return false;\n      } else {\n        return true;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var children = this.props.children;\n      return /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 16\n        }\n      }, children);\n    }\n  }]);\n\n  return FuseAuthorization;\n}(Component);\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({}, dispatch);\n}\n\nfunction mapStateToProps(_ref) {\n  var fuse = _ref.fuse,\n      auth = _ref.auth;\n  return {\n    user: auth.user\n  };\n}\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(FuseAuthorization));","map":{"version":3,"sources":["C:/Projects/Trunks/OWP-GIT/owp-fe/node_modules/owp/src/@fuse/components/FuseAuthorization/FuseAuthorization.js"],"names":["_","React","Component","connect","matchRoutes","withRouter","bindActionCreators","redirect","FuseAuthorization","props","checkAuth","prevProps","isEqual","location","pathname","matched","routes","process","env","REACT_APP_LOGIN_CHECK","route","auth","length","user","role","history","push","state","redirectUrl","includes","nextProps","children","mapDispatchToProps","dispatch","mapStateToProps","fuse"],"mappings":";;;;;AAAA,OAAOA,CAAP,MAAc,QAAd;AACA,OAAOC,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,WAAT,QAA4B,qBAA5B;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,kBAAT,QAAmC,OAAnC;AAEA,IAAIC,QAAQ,GAAG,KAAf;;IAEMC,iB;;;;;AACF,6BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,8BAAMA,KAAN;;AACA,UAAKC,SAAL;;AAFe;AAGlB;;;;WAED,4BAAmBC,SAAnB,EAA8B;AAC1B;AACR;AACA;AACA;AACQ,UAAI,CAACX,CAAC,CAACY,OAAF,CAAU,KAAKH,KAAL,CAAWI,QAAX,CAAoBC,QAA9B,EAAwCH,SAAS,CAACE,QAAV,CAAmBC,QAA3D,CAAL,EAA2E;AACvE,aAAKJ,SAAL;AACH;AACJ;;;WAED,qBAAY;AACR,UAAMK,OAAO,GAAGX,WAAW,CAAC,KAAKK,KAAL,CAAWO,MAAZ,EAAoB,KAAKP,KAAL,CAAWI,QAAX,CAAoBC,QAAxC,CAAX,CAA6D,CAA7D,CAAhB;;AAEA,UAAIG,OAAO,CAACC,GAAR,CAAYC,qBAAZ,KAAsC,OAA1C,EAAmD;AAC/CZ,QAAAA,QAAQ,GAAG,KAAX;AACA;AACH;;AAED,UAAIU,OAAO,CAACC,GAAR,CAAYC,qBAAZ,KAAsC,MAA1C,EAAkD;AAC9C,YAAIJ,OAAO,KAAK,CAACA,OAAO,CAACK,KAAR,CAAcC,IAAf,IAAuB,CAACN,OAAO,CAACK,KAAR,CAAcC,IAAd,CAAmBC,MAAhD,CAAX,EAAoE;AAChEf,UAAAA,QAAQ,GAAG,IAAX;;AAEA,cAAI,KAAKE,KAAL,CAAWc,IAAX,CAAgBC,IAAhB,KAAyB,OAA7B,EAAsC;AAClC,iBAAKf,KAAL,CAAWgB,OAAX,CAAmBC,IAAnB,CAAwB;AACpBZ,cAAAA,QAAQ,EAAE,QADU;AAEpBa,cAAAA,KAAK,EAAE;AAAEC,gBAAAA,WAAW,EAAE,KAAKnB,KAAL,CAAWI,QAAX,CAAoBC;AAAnC;AAFa,aAAxB;AAIH;;AAED;AACH;;AAED,YAAIC,OAAO,IAAIA,OAAO,CAACK,KAAR,CAAcC,IAAzB,IAAiCN,OAAO,CAACK,KAAR,CAAcC,IAAd,CAAmBC,MAAnB,GAA4B,CAAjE,EAAoE;AAChE,cAAI,CAACP,OAAO,CAACK,KAAR,CAAcC,IAAd,CAAmBQ,QAAnB,CAA4B,KAAKpB,KAAL,CAAWc,IAAX,CAAgBC,IAA5C,CAAL,EAAwD;AACpDjB,YAAAA,QAAQ,GAAG,IAAX;;AACA,gBAAI,KAAKE,KAAL,CAAWc,IAAX,CAAgBC,IAAhB,KAAyB,OAA7B,EAAsC;AAClC,mBAAKf,KAAL,CAAWgB,OAAX,CAAmBC,IAAnB,CAAwB;AACpBZ,gBAAAA,QAAQ,EAAE,QADU;AAEpBa,gBAAAA,KAAK,EAAE;AAAEC,kBAAAA,WAAW,EAAE,KAAKnB,KAAL,CAAWI,QAAX,CAAoBC;AAAnC;AAFa,eAAxB;AAIH,aALD,MAKO;AACH,mBAAKL,KAAL,CAAWgB,OAAX,CAAmBC,IAAnB,CAAwB;AACpBZ,gBAAAA,QAAQ,EAAE;AADU,eAAxB;AAGH;AACJ;AACJ;AACJ;AACJ;;;WAED,+BAAsBgB,SAAtB,EAAiC;AAC7B,UAAIvB,QAAJ,EAAc;AACVA,QAAAA,QAAQ,GAAG,KAAX;AACA,eAAO,KAAP;AACH,OAHD,MAGO;AACH,eAAO,IAAP;AACH;AACJ;;;WAED,kBAAS;AAAA,UACGwB,QADH,GACgB,KAAKtB,KADrB,CACGsB,QADH;AAGL,0BAAO,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAiBA,QAAjB,CAAP;AACH;;;;EArE2B7B,S;;AAwEhC,SAAS8B,kBAAT,CAA4BC,QAA5B,EAAsC;AAClC,SAAO3B,kBAAkB,CAAC,EAAD,EAAK2B,QAAL,CAAzB;AACH;;AAED,SAASC,eAAT,OAAyC;AAAA,MAAdC,IAAc,QAAdA,IAAc;AAAA,MAARd,IAAQ,QAARA,IAAQ;AACrC,SAAO;AACHE,IAAAA,IAAI,EAAEF,IAAI,CAACE;AADR,GAAP;AAGH;;AAED,eAAelB,UAAU,CAACF,OAAO,CAAC+B,eAAD,EAAkBF,kBAAlB,CAAP,CAA6CxB,iBAA7C,CAAD,CAAzB","sourcesContent":["import _ from 'lodash';\r\nimport React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { matchRoutes } from 'react-router-config';\r\nimport { withRouter } from 'react-router-dom';\r\nimport { bindActionCreators } from 'redux';\r\n\r\nlet redirect = false;\r\n\r\nclass FuseAuthorization extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.checkAuth();\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n        /**\r\n         * If route is changed\r\n         * Update auths\r\n         */\r\n        if (!_.isEqual(this.props.location.pathname, prevProps.location.pathname)) {\r\n            this.checkAuth();\r\n        }\r\n    }\r\n\r\n    checkAuth() {\r\n        const matched = matchRoutes(this.props.routes, this.props.location.pathname)[0];\r\n\r\n        if (process.env.REACT_APP_LOGIN_CHECK === 'false') {\r\n            redirect = false;\r\n            return;\r\n        }\r\n\r\n        if (process.env.REACT_APP_LOGIN_CHECK === 'true') {\r\n            if (matched && (!matched.route.auth || !matched.route.auth.length)) {\r\n                redirect = true;\r\n\r\n                if (this.props.user.role === 'guest') {\r\n                    this.props.history.push({\r\n                        pathname: '/login',\r\n                        state: { redirectUrl: this.props.location.pathname },\r\n                    });\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            if (matched && matched.route.auth && matched.route.auth.length > 0) {\r\n                if (!matched.route.auth.includes(this.props.user.role)) {\r\n                    redirect = true;\r\n                    if (this.props.user.role === 'guest') {\r\n                        this.props.history.push({\r\n                            pathname: '/login',\r\n                            state: { redirectUrl: this.props.location.pathname },\r\n                        });\r\n                    } else {\r\n                        this.props.history.push({\r\n                            pathname: '/',\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps) {\r\n        if (redirect) {\r\n            redirect = false;\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { children } = this.props;\r\n\r\n        return <React.Fragment>{children}</React.Fragment>;\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({}, dispatch);\r\n}\r\n\r\nfunction mapStateToProps({ fuse, auth }) {\r\n    return {\r\n        user: auth.user,\r\n    };\r\n}\r\n\r\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(FuseAuthorization));\r\n"]},"metadata":{},"sourceType":"module"}